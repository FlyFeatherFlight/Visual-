
@{
    ViewBag.Title = "经销商数据";
}
<link href="~/Content/scroolWidth.css" rel="stylesheet" />
<h3>经销商数据</h3>
<div  style="margin-left:2.5%;padding:5px 0;">
    <select class=" search-input" id="sheng">
    </select>
    <select class="search-input" id="shi">
    </select>
    <select class="search-input" id="_Man">
        <option value="">-请选择录入人-</option>
    </select>
    <input type="text" id="startDate" value="" class="search-input dateTime" placeholder="请选择开始日期" readonly />至
    <input type="text" id="endDate" value="" class="search-input dateTime" placeholder="请选择结束日期" readonly />
    <input type="submit" name="" value="查询" id="subSearch" />
    <input type="button" onclick="  toExcel($('#Table'))" value="导出数据" />
    <p class="red">Tips:默认显示本月的数据，其他数据请根据条件自行查询</p>
</div>
<div style="margin-left:2.5%;">
    <div class="hidden Top">
        <table id="Tab">
            <tr>
                <th><div class="width-75">城市</div></th>
                <th>
                    <div class="width-75">城市等级</div>
                </th>
                <th><div class="width-102">企业名称/法人代表</div></th>
                <th><div class="width-30">经销商等级</div></th>
                <th><div class="width-102">经销商来源</div></th>
                <th><div class="width-200">经销商特征</div></th>
                <th>
                    <div class="width-410">联系人</div>
                </th>
                <th>
                    <div class="width-102">地址</div>
                </th>
                <th>
                    <div class="width-200">社会资源描述</div>
                </th>
                <th>
                    <div class="width-140">代理品牌</div>
                </th>
                <th>
                    <div class="width-30">是否现代品牌</div>
                </th>
                <th>
                    <div class="width-56">经营年限</div>
                </th>
                <th>
                    <div class="width-102">年销售额(万元)</div>
                </th>
                <th>
                    <div class="width-102">团队人数</div>
                </th>
                <th>
                    <div class="width-102">入驻商场</div>
                </th>
                <th>
                    <div class="width-102">门店数量</div>
                </th>
                <th>
                    <div class="width-102">投资预算(元/平方)</div>
                </th>
                <th>
                    <div class="width-102">意向商场</div>
                </th>

                <th>
                    <div class="width-30">商场等级</div>
                </th>
                <th>
                    <div class="width-102">预算面积</div>
                </th>
                <th>
                    <div class="width-30">意向位置分级</div>
                </th>

                <th>
                    <div class="width-200">盈利情况</div>
                </th>
                <th>
                    <div class="width-30">匹配度</div>
                </th>

                <th>
                    <div class="width-102">备注</div>
                </th>
                <th>
                    <div class="width-50">录入人</div>
                </th>
                <th>
                    <div class="width-102">更新日期</div>
                </th>

            </tr>
        </table>
    </div>
    <div class="Botoom">
        <table class="text-center" id="Table">
            <thead>
                <tr>
                    <th><div class="width-75">城市</div></th>
                    <th>
                        <div class="width-75">城市等级</div>
                    </th>
                    <th><div class="width-102">企业名称/法人代表</div></th>
                    <th><div class="width-30">经销商等级</div></th>
                    <th><div class="width-102">经销商来源</div></th>
                    <th><div class="width-200">经销商特征</div></th>
                    <th>
                        <div class="width-410">联系人</div>
                    </th>
                    <th>
                        <div class="width-102">地址</div>
                    </th>
                    <th>
                        <div class="width-200">社会资源描述</div>
                    </th>
                    <th>
                        <div class="width-140">代理品牌</div>
                    </th>
                    <th>
                        <div class="width-30">是否现代品牌</div>
                    </th>
                    <th>
                        <div class="width-56">经营年限</div>
                    </th>
                    <th>
                        <div class="width-102">年销售额(万元)</div>
                    </th>
                    <th>
                        <div class="width-102">团队人数</div>
                    </th>
                    <th>
                        <div class="width-102">入驻商场</div>
                    </th>
                    <th>
                        <div class="width-102">门店数量</div>
                    </th>
                    <th>
                        <div class="width-102">投资预算(元/平方)</div>
                    </th>
                    <th>
                        <div class="width-102">意向商场</div>
                    </th>

                    <th>
                        <div class="width-30">商场等级</div>
                    </th>
                    <th>
                        <div class="width-102">预算面积</div>
                    </th>
                    <th>
                        <div class="width-30">意向位置分级</div>
                    </th>

                    <th>
                        <div class="width-200">盈利情况</div>
                    </th>
                    <th>
                        <div class="width-30">匹配度</div>
                    </th>

                    <th>
                        <div class="width-102">备注</div>
                    </th>
                    <th>
                        <div class="width-50">录入人</div>
                    </th>
                    <th>
                        <div class="width-102">更新日期</div>
                    </th>

                </tr>
            </thead>
            <tbody></tbody>

        </table>
    </div>
</div>
<script>
    var nowMonth = getCurrentMonthFirst();
    GetFranchiserJson(null, null, nowMonth, null);
    scroollHeadTab();
    //根据选择的省份，获取市数据
    /****查询***/
    //获取省  =>  改变省获取市数据
    getProvince($("#sheng"));
    getMan($("#_Man"));
    $("#sheng").change(function () {
        $("#shi").empty();
        getShi($("#sheng").val(), $("#shi"));
    })
    $("#subSearch").click(function () {
        let cid = $("#shi").val(),
            emid = $("#_Man").val(),
            startDate = $("#startDate").val(),
            endDate = $("#endDate").val();

        GetFranchiserJson(cid, emid, startDate, endDate);
    })
    function GetFranchiserJson(cid, emid, startDate, endDate) {
        $("#Table tbody").html("  <tr><td class='loading' style='text-align: start; height: 120px;' colspan='26'>正在加载</td></tr>");

        $.ajax({
            url: '@Url.Action("GetFranchiserJson", "DevelopmentDoc")',
            type: 'get',
            data: { cid: cid, emid: emid, startDate: startDate, endDate: endDate},
            dataType: 'json',
            success: function (data) {
               console.log(data)
                if (data.success) {
                    if (data.date.length > 0) {
                        let HtmlStr = "";
                        $(data.date).each(function (i, m) {
                            HtmlStr += "  <tr><td>" + m.城市 + "</td><td>" + m.城市等级 + "</td><td>" + m.企业名称 + "</td><td>" + m.经销商等级 +
                                "</td><td>" + m.经销商来源 + "</td><td>" + m.经销商特征 + "</td><td><table style='margin:0 auto'>" + FranchicserContactList(m.ID) +
                                "</table></td><td>" + m.地址 + "</td><td>" + m.社会资源描述 + "</td><td>" + m.代理品牌 + "</td><td>" + m.经营年限 + "</td><td>" + m.年销售额 +
                                "</td><td>" + m.团队人数 + "</td><td>" + m.入驻商场 + "</td><td>" + m.门店数量 + "</td><td>" + m.投资预算 + "</td><td>" + m.意向商场 + "</td><td>" + m.商场等级 +
                                "</td><td>" + m.预算面积 + "</td><td>" + m.意向位置分级 + "</td><td>" + m.盈利情况 + "</td><td>" + m.匹配度 + "</td><td>" + m.备注 + 
                                "</td><td>" + m.备注 + "</td><td>" + m.录入人 + "</td><td>" + dateFtt("yyyy-MM-dd", m.更新日期) + "</td></tr>"
                        })
                        $("#Table tbody").html(HtmlStr);
                        clearNull($("#Table td"));
                    } 

                } else {
                    $("#Table tbody").html("  <tr><td style='text-align: start; height: 120px;' colspan='26'>暂无数据！</td></tr>")
                }
            },
            error: function (err) {
                console.log(err)
            }
         })
    }

    //获取商场联系人
    function FranchicserContactList(id) {
        var HtmlStr = "";
        $.ajax({
            url: '@Url.Action("FranchicserContactList", "DevelopmentDoc")',
            type: 'post',
            data: { id: id},
            dataType: 'json',
            async: false,
            success: function (data) {
                console.log(data)
              
                if (data.success) {
                     HtmlStr = "<tr><td>联系人</td><td>性别</td><td>职务</td><td>联系方式</td></tr>";
                    if (data.data.length > 0) {

                        $(data.data).each(function (i, m) {
                            HtmlStr += "<tr><td>" + m.姓名 + "</td><td>" + m.性别 + "</td><td>" + m.职务 + "</td><td>" + m.联系方式 + "</span></tr>"
                        })

                    } else {
                        HtmlStr += "<tr><td colspan='4' class='red'>暂无数据!</td></tr>"
                    }

                } else {
                    alert(data.msg);
                }
            },
            error: function (err) {
                console.log(err)
            }
        })

        return HtmlStr;
    }
   
</script>
<script src="~/Scripts/exportTables.js"></script>
